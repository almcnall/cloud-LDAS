---
jupytext:
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
    format_version: 0.13
    jupytext_version: 1.17.3
kernelspec:
  name: bash
  display_name: Bash
  language: bash
---

# Contributing Guide

+++

As noted in the README, this guide is [MyST Markdown], with cells you can run interatively using the bash kernel when the [Jupytext] extension is available.

[MyST Markdown]: https://mystmd.org/
[Jupytext]: https://jupytext.readthedocs.io/

+++

## Setup

+++

Create a "workspace" environment and point the "python3" kernelspec at the new environment.
Note that [scripts/README](scripts/README.md) includes similar setup instructions for the purpose of reproducing results only.

```{code-cell}
conda-lock install --name workspace conda-lock.yml
```

In the next step, a `WARNING` that says the "kernelspec may not be found" is possible.

```{code-cell}
conda run --name workspace python -m ipykernel install --prefix="$CONDA_PREFIX"
```

Neither this new environment nor the kernelspec modification will persist between JupyterLab servers.

+++

### Develop in Notebooks

+++

The code repository does not store Jupyter notebooks (extension ".ipynb").
Instead, we store Python scripts (extension ".py") that the [Jupytext] extension keeps automatically synced with notebooks.
Those scripts are what we run "operationally" (i.e. to reprocess files and perform benchmarking).
While developing, however, we prefer to use notebooks.

To initialize the .ipynb notebooks after a cloning this repo, or when pulling a new script, run the cell below to sync manually.
When working in JupyterLab, Jupytext performs synchronization on save and on opening a paired notebook.

[Jupytext]: https://jupytext.readthedocs.io/

```{code-cell}
jupytext --sync scripts/*.py
```

## Dependencies

+++

The project dependencies are listed in `environment.yml` following the specifications for Conda environment definition.
We need a Conda environment to get the `h5repack` and `nccopy` command line utilities that come with `hdf5` and `libnetcdf`.

[Conda]: https://docs.conda.io/

+++

## Reproducible Environment Configuration

+++

A fully specified Conda environment can be created from the `conda-lock.yml` file generated by [conda-lock].
After adding a new dependency to `environment.yml`, you must regenerate the `conda-lock.yml` file as follows.

[conda-lock]: https://conda.github.io/conda-lock/

```{code-cell}
conda-lock lock --file environment.yml
```
